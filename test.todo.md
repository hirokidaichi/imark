# テスト追加が必要なファイル

1. [x] src/main.ts
2. [ ] src/commands/caption.ts
3. [x] src/utils/image.ts

## テスト実装の優先順位と方針

### 1. src/commands/caption.ts
- キャプション生成コマンドの実装テスト
- 入力パラメータの検証
- エラーハンドリングのテスト

### 2. src/utils/image.ts
- 画像処理ユーティリティのテスト
- Base64エンコード/デコードのテスト
- MIMEタイプ検証のテスト

### 3. src/main.ts
- CLIエントリーポイントのテスト
- コマンドライン引数の解析テスト
- サブコマンドのディスパッチテスト

## 修正が必要なテスト

### src/commands/caption.test.ts
現在スキップされているテストの修正が必要です。

#### 1. GeminiClientのモック方法の改善
- [ ] GeminiClientのインターフェースを定義
- [ ] モッククラスをインターフェースに準拠させる
- [ ] テスト用のモックファクトリを作成

#### 2. メソッドのスタブ化の問題
- [ ] configurable: trueの設定方法の見直し
- [ ] スタブの適切なライフサイクル管理
- [ ] テストケース間での状態の分離

#### 3. テストカバレッジの向上
- [ ] 言語オプションのテストケース追加
- [ ] 不正なオプション値のテストケース追加
- [ ] コンテキストファイルの異常系テスト追加

#### 4. テストの保守性向上
- [ ] テストヘルパー関数の作成
- [ ] 共通のモックセットアップ処理の抽出
- [ ] テストデータの外部化 